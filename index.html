<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>:MELONAM: Madnes Race</title>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<style>
  body, html {
    margin:0; padding:0;
    width:100%; height:100%;
    overflow:hidden;
    background:#000;
    font-family: 'Orbitron', sans-serif;
    user-select:none;
  }
  canvas { display:block; }

  /* –ú–µ–Ω—é */
  #menu {
    position:absolute; top:0; left:0;
    width:100%; height:100%;
    background: linear-gradient(135deg, #1a1a1a, #333);
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    color:#fff; text-align:center;
  }

  #menu h1 {
    font-size:3.5em;
    margin-bottom:10px;
    color:#FFD700;
    text-shadow:0 0 10px #000;
  }

  #menu p {
    font-size:1.4em; margin-bottom:20px;
  }

  .btn {
    background:#222;
    color:#fff;
    padding:12px 28px;
    margin:6px;
    cursor:pointer;
    border:2px solid #555;
    border-radius:10px;
    font-size:1.2em;
    transition:0.3s;
  }

  .btn:hover {
    background:#444;
    border-color:#888;
    transform:scale(1.05);
  }

  #carSelect, #locSelect {
    margin-bottom:15px;
  }
</style>
</head>

<body>

<div id="menu">
  <h1>:MELONAM: Madnes Race</h1>
  <p>–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—à–∏–Ω—É:</p>
  <div id="carSelect">
    <button class="btn" data-car="car">üèéÔ∏è –ú–∞—à–∏–Ω–∞</button>
    <button class="btn" data-car="tank">ÔøΩ tank</button>
    <button class="btn" data-car="helicopter">üöÅ –í–µ—Ä—Ç–æ–ª—ë—Ç</button>
    <button class="btn" data-car="ufo">üõ∏ –ù–õ–û</button>
    <button class="btn" data-car="buggy">üöô –ë–∞–≥–≥–∏</button>
    <button class="btn" data-car="hover">üõª –•–æ–≤–µ—Ä–∫–∞—Ä</button>
  </div>
  <p>–í—ã–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é:</p>
  <div id="locSelect">
    <button class="btn" data-loc="0">üåµ –ü—É—Å—Ç—ã–Ω—è</button>
    <button class="btn" data-loc="1">üåï –õ—É–Ω–∞</button>
    <button class="btn" data-loc="2">üî¥ –ú–∞—Ä—Å</button>
    <button class="btn" data-loc="3">‚õ∞Ô∏è –ì–æ—Ä—ã</button>
    <button class="btn" data-loc="4">üèôÔ∏è –ú–µ—Ç—Ä–æ–ø–æ–ª–∏—Å</button>
  </div>
</div>

<canvas id="game"></canvas>

<script>
// ===========
// Canvas Setup
// ===========

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// ==============
// Game Variables
// ==============

let gameStarted = false;
let chosenCar = 'car';
let chosenLoc = 0;
let terrain = [];
let offset = 0;
let carX = 100, carY = 0;
let carVY = 0;
let gravity = 0.7;
let jumping = false;
let score = 0;

// Machine Data
const cars = {
  car: { img:'https://i.imgur.com/4F3h0Mk.png', w:70, h:40 },
  tank: { img:'https://i.imgur.com/ej8N6kV.png', w:80, h:50 },
  helicopter: { img:'https://i.imgur.com/6bkXbM9.png', w:100, h:50 },
  ufo: { img:'https://i.imgur.com/ExyGbsx.png', w:90, h:40 },
  buggy: { img:'https://i.imgur.com/GCbGfiT.png', w:70, h:35 },
  hover: { img:'https://i.imgur.com/XuJdUvB.png', w:80, h:40 }
};

// Location Colors
const locs = [
  {bg:'#EDC9AF', hill:100},
  {bg:'#AAA', hill:50},
  {bg:'#B22222', hill:80},
  {bg:'#556B2F', hill:150},
  {bg:'#555', hill:70}
];

// Images Loader
for(let k in cars){
  cars[k].image = new Image();
  cars[k].image.src = cars[k].img;
}

// ================
// Menu Interactions
// ================

document.querySelectorAll('#carSelect .btn').forEach(b => {
  b.onclick = () => {
    chosenCar = b.dataset.car;
    tryStart();
  }
});

document.querySelectorAll('#locSelect .btn').forEach(b => {
  b.onclick = () => {
    chosenLoc = parseInt(b.dataset.loc);
    tryStart();
  }
});

function tryStart(){
  if(chosenCar && chosenLoc!==undefined){
    document.getElementById('menu').style.display='none';
    startGame();
  }
}

// ========
// Controls
// ========

let left=false, right=false;
document.addEventListener('keydown', e=>{
  if(e.key==='ArrowUp' || e.key===' ') jump();
  if(e.key==='ArrowRight') right=true;
  if(e.key==='ArrowLeft') left=true;
});

document.addEventListener('keyup', e=>{
  if(e.key==='ArrowRight') right=false;
  if(e.key==='ArrowLeft') left=false;
});

canvas.addEventListener('touchstart', e=>{
  if(e.touches[0].clientX < canvas.width/2) jump();
});

// =============
// Terrain
// =============

function generateTerrain(){
  terrain=[];
  let y = canvas.height - 150;
  for(let i=0;i<300;i++){
    y += (Math.random()-0.5)*locs[chosenLoc].hill;
    terrain.push(y);
  }
}

// ========
// Jump
// ========

function jump(){
  if(!jumping){
    carVY = -13;
    jumping = true;
  }
}

// =========
// Main Loop
// =========

function startGame(){
  generateTerrain();
  offset = 0;
  carY = terrain[0] - cars[chosenCar].h;
  requestAnimationFrame(gameLoop);
}

function gameLoop(){
  // Background
  ctx.fillStyle = locs[chosenLoc].bg;
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Move Camera
  offset += 3 + (right?2:0) - (left?2:0);
  score = Math.floor(offset / 5);

  // Draw Terrain
  ctx.beginPath();
  for(let i=0;i<terrain.length;i++){
    let tx = i*10 - offset;
    let ty = terrain[i];
    if(i===0) ctx.moveTo(tx,ty);
    else ctx.lineTo(tx,ty);
  }
  ctx.lineTo(canvas.width,canvas.height);
  ctx.lineTo(0,canvas.height);
  ctx.closePath();
  ctx.fillStyle='#654321';
  ctx.fill();

  // Car Physics
  let idx = Math.floor(offset/10);
  if(idx >= terrain.length-1) generateTerrain();
  let baseY = terrain[idx] - cars[chosenCar].h;
  carY += carVY;
  carVY += gravity;
  if(carY > baseY){
    carY = baseY;
    carVY = 0;
    jumping = false;
  }

  // Draw Car
  let c = cars[chosenCar];
  ctx.drawImage(c.image,carX,carY,c.w,c.h);

  // HUD
  ctx.fillStyle='white';
  ctx.font='24px Orbitron';
  ctx.fillText(`:MELONAM: Madnes Race`, 20, 40);
  ctx.fillText(`Score: ${score}`, 20, 70);
  ctx.fillText(`Location: ${['–ü—É—Å—Ç—ã–Ω—è','–õ—É–Ω–∞','–ú–∞—Ä—Å','–ì–æ—Ä—ã','–ú–µ—Ç—Ä–æ–ø–æ–ª–∏—Å'][chosenLoc]}`, 20, 100);

  requestAnimationFrame(gameLoop);
}
</script>

</body>
</html>
